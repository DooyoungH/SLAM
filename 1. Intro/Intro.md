# Introduction to Robot Mapping


## 1. Intro 
ROS는 로봇산업분야에서 많이 사용되고 있는 툴로써 로봇을 URDF (Universal Robotic Description Format) 로 작성하고 이 로봇과 환경에 여러 외부 요소 (관성, 속도, 가속도 같은 힘과 물체의 특성치) 를 고려하여 로봇의 움직임을 시뮬레이션으로 확인해 볼 수 있습니다.

우리나라는 현재 표윤석 박사님을 필두로 운영되는 오픈 로봇 기술 공유 카페 오로카 [1][https://cafe.naver.com/openrt] 를 필두로 ROS 에 대한 연구들이 진행되고 있으며, 해당 카페에서 어느정도의 튜토리얼은 수월하게 진행 할 수 있습니다. 
하지만 응용부분에 넘어선다면 한글화 자료가 매우 찾기 힘들며, ROS의 기능이 활용되는 프로젝트를 직접 수행해 보지 않는다면 자신이 원하는 환경에 맞추어서 패키지를 변경하기도 매우 쉽지 않습니다. 

특히 ROS 에서 많이 언급 되는 SLAM 패키지는 이미 많은 자료가 존재하여 수행하기에는 문제가 없지만 이를 활용하여 무언가를 만들어내기에는 그 기반적인 설명이 부족합니다.
SLAM 이라는 기법론 자체부터 많은량의 이론적 지식을 필요로 하며 전공자가 아니라면 접근이 쉽지 않습니다. 

본 문서는 본인이 공부를 진행하면서 이해한 내용과 코드 내용을 기록해 놓는 저장소 입니다. 
저 또한 공부를 위해 많은 사이트를 참고하였으며 티스토리의 확률적 로봇공학을 소개한 사이트 [2][https://throwexception.tistory.com/316?category=869774] 와 파이썬 로보틱스 [3][https://pythonrobotics.readthedocs.io/en/latest/getting_started.html] 를 주로 참고하였습니다.

모든 내용을 A to Z 까지 설명하진 않겠지만 그래도 SLAM 을 공부할 때 무엇부터 해야 할 지 막막한 분들에게 도움이 되었으면 좋겠습니다.


## 2. SLAM (Simultaneous localization and mapping) 이란?

로봇은 물리적 세계에서 센서들을 이용해 주변을 감지하고 제어를 통해 움직임을 정밀하게 수행하는 학문입니다.
덧붙여 요즘과 같이 AI 를 통해 자신의 움직임에 대한 판단이 가능해지면서 지능을 가진 로봇은 우리의 사회를 바꿀 큰 잠재력을 지니게 되었습니다.

하지만 로봇 공학에서는 불확실성(Uncertainty) 라는 critical 한 요소가 있습니다.
불확실성은 로봇이 움직이는데 필요한 정보들이 부족할 때 생기는데, 여기에는 5가지의 요인이 있습니다.

1. 환경 : 우리가 사는 물리적 환경은 사실 예측하기가 굉장히 어렵습니다. 
우리의 환경은 시간에 따라 시시각각으로 변하며 우리가 목표로 하는 시스템과는 별개의 외부의 요소들이 끊임 없이 시스템에 영향을 주기 때문입니다.

2. 로봇 : 로봇의 구동계는 대부분 전기적 모터와 제어기로 이루어져 있습니다. 
이는 제조방법 및 사용용도에 따라 정확도가 천차만별로 다르며 모든 모터에 대하여 검증을 진행할 수 없기 때문에 로봇 자체의 불확실성은 항상 존재하게 됩니다.

3. 센서 : 로봇은 주변의 환경을 센서로 받아들이지만 대부분의 센서값들은 노이즈를 포함한 평균값으로 도출 됩니다.
샘플링수가 많을 수록 가우시안 분포에 따라 하나의 평균으로 수렴하겠지만 이 역시 어차피 노이즈를 포함한 평균이므로 실제 환경과 다른 정보를 제공할 수 있는 가능성은 언제나 존재합니다.

4. 모델 : 따라서 많은 연구자들은 로봇을 하나의 추상화(특징을 알 수 있게 간략화) 된 모델을 사용합니다.
사실상 모델은 2 와 3의 교집합으로 로봇 구동계의 에러와 센서의 에러가 합쳐지지만 모델 단계에서는 대부분 이 에러를 무시하게 됩니다.  

5. 계산 : 로봇의 온보드 컴퓨터는 계산량이 한정되어 있습니다. 특히 알고리즘이 해결해야하는 time complexity 가 높을 수록 로봇은 자신의 역할을 제대로 수행하지 못합니다.

이러한 모든 요인들이 로봇의 움직임에 불확실성을 일으키게 됩니다. 
학술적으로는 이런 불확실성을 대부분 무시하지만 로봇이 실제 환경에서 구현 될 때 불확실성은 로봇의 malfunction 의 주된 원인이 됩니다. 

그럼 이제 본격적으로 슬램에 대하여 언급해보도록 하겠습니다.
본인이 이해하는 슬램은 로봇에 센서들을 추가하여 로봇이 자신의 주위의 환경을 파악하고 자신의 몸체가 환경의 어디에 위치하는 지를 알아내는 기술입니다.

이는 indoor 에서 활동하는 로봇들과 아주 밀접한 관련이 있는데, GPS 정보를 제외하면 로봇은 자신의 절대적인 positioning 을 알아 낼 방법이 없고,
GPS의 도움 없이 데드레커닝 (모터에 달린 엔코더의 정보를 통해 로봇의 이동 경로를 알아내는 방법) 등에 의존하여 로봇을 동작하기에는 불확실성에 의해 정밀성이 매우 떨어집니다.
따라서 연구자들은 로봇에 주변을 감지하기 위한 센서 (주로 비전이나 라이다 센서)들을 더 많이 추가하여 로봇 주변의 환경을 파악하여 (할 수 있다면 맵을 그려 보존하여) 로봇이 주변의 환경과의 충돌없이
움직임을 수행하게끔 하고자 하였습니다.

일반적으로 Robot mapping (SLAM) 에 연관된 topic 들은 다음과 같습니다.

1. State Estimation : 환경 속 로봇의 위치, 속도 등의 state 를 Bayes filter 와 같은 방법을 사용하여 추정 합니다.

베이즈 정리는 확률론과 통계학에서 많이 사용되며, 두 확률변수의 관계를 나타내는 정리입니다.

$$
P(A|B) = \frac{P(B|A)P(A)}{P(B)}
$$
* 수식이 보이지 않을 경우 구글의 mathjax plugin 을 설치해주세요.

A : 경험적으로 알고 있는 사건\
B : 관심이 있는 사건\
B|A : 경험적으로 알고 있는 사건이 일어났을 때 B의 확률\
A|B : 관심이 있는 사건이 일어났을 때 A의 확률


베이지안 확률론은 어떠한 사건에 관련이 있는 여러 확률을 이용하여 새롭게 일어날 수 있는 사건에 대한 확률을 추정하는 방법으로,
일어나지 않은 일에 대한 확률을 불확실성의 개념으로 이야기 하고 있습니다.

외람되지만 저는 베이즈 정리를 어떤 사건이 일어날 확률 A와 이를 업데이트하는 B 로 이해하는 편이 이해가 빨랐습니다.\
P(B의 영향을 받은 A가 일어날 확률) = P(B가 A에 준 영향의 정도) * P(A가 일어날 확률) 

이렇게 구해진 P(A|B) 를 다시 P(A)로 치환하고 매 스탭마다 반복하여 확률을 계산하는 방법을 응용하여
로봇의 state를 observation 과 control input으로 부터 구해내는 방법을 bayes filter 라고 합니다.

다음의 정진영 선생님의 깃 블로그 [4][http://jinyongjeong.github.io/2017/02/13/lec01_SLAM_bayes_filter/] 에 유도 과정이 설명이 잘 되어 있습니다.

2. Localization : 로봇의 position 및 orientation 을 알아내는 방법으로 state estimation의 한 부분 입니다.
주변의 환경의 정보로부터 로봇의 위치를 알아냅니다.

3. Mapping : Localization 와는 반대로 로봇에서 noisy 한 sensor 의 데이터를 통해 주변의 환경의 정보를 알아내는 방법입니다.

4. SLAM : 로봇이 자신의 위치를 알기 위해서는 주변 환경에 대한 정보를 파악하여야 하며, 그 환경을 알기 위해서는 현재 자신이 위치한 위치를 알아야 하므로 결국 Simultaneous localization and mapping 은 결국 서로 상호작용을 하는 2와 3을 동시에 진행하는 것 입니다. 

이하의 내용은 항공학도님의 티스토리 [5][https://sunggoo.tistory.com/40?category=865372] 를 참고하였습니다.


SLAM 의 problem formulation 은 다음과 같습니다.

>$Given$ :
>1. 로봇의 control input 	$u_{1:T} = \{u_1, u_2, ..., u_T\}$\
>2. 센서의 sensing value	$z_{1:T} = \{z_1, z_2, ..., z_T\}$\
>
>$Control knob$ :\
>로봇의 control input 과  
>$Objective$ :\




[1] : https://cafe.naver.com/openrt \
[2] : https://throwexception.tistory.com/316?category=869774 \
[3] : https://pythonrobotics.readthedocs.io/en/latest/getting_started.html \
[4] : http://jinyongjeong.github.io/2017/02/13/lec01_SLAM_bayes_filter/ \
[5] : https://sunggoo.tistory.com/40?category=865372
 